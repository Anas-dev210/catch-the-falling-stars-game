<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Catch the Falling Stars</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
html,body{height:100%;margin:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(#021,#013);font-family:Arial,Helvetica,sans-serif;color:#fff}
#gameCanvas{background:#001;box-shadow:0 10px 30px rgba(0,0,0,.7),0 0 60px rgba(255,255,150,.03) inset;border-radius:8px}
.overlay{position:absolute;width:800px;text-align:center;pointer-events:none;color:#ffeaa7}
#centerMessage{top:260px;left:calc(50% - 400px);font-size:28px;font-weight:700;text-shadow:0 2px 6px rgba(0,0,0,.7)}
button#restartBtn{margin-top:12px;pointer-events:all;background:#ffcc66;border:none;padding:10px 18px;border-radius:6px;cursor:pointer;font-weight:700}
small.hint{display:block;color:#ddd;margin-top:8px;font-weight:400}
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div class="overlay" id="centerMessage" style="display:none">
  <div id="centerText"></div>
  <div><button id="restartBtn">Start / Restart</button></div>
  <small class="hint">Use ← and → keys to move basket. Space to start.</small>
</div>
<script>
(function(){
  const canvas=document.getElementById('gameCanvas'),ctx=canvas.getContext('2d'),W=canvas.width,H=canvas.height;
  const GAME_DURATION=60,DIFFICULTY_STEP=15,BASE_SPAWN_INTERVAL=700,BASE_FALL_SPEED=70,STORAGE_KEY='catch_falling_stars_hs';
  let lastTime=0,accumSpawn=0,running=false,timeLeft=GAME_DURATION,score=0,highScore=0,stars=[],keys={left:!1,right:!1},basket={w:120,h:18,x:(W-120)/2,y:H-48,speed:420};
  let bgStars=[];
  const centerMessage=document.getElementById('centerMessage'),centerText=document.getElementById('centerText'),restartBtn=document.getElementById('restartBtn');

  function drawStarShape(ctx,cx,cy,outerR,innerR,points){ctx.beginPath();const step=Math.PI/points;for(let i=0;i<2*points;i++){const r=(i%2===0)?outerR:innerR,ang=i*step-Math.PI/2,x=cx+Math.cos(ang)*r,y=cy+Math.sin(ang)*r;i?ctx.lineTo(x,y):ctx.moveTo(x,y)}ctx.closePath();ctx.fill()}
  function rectCircleCollide(cx,cy,r,rx,ry,rw,rh){const closestX=Math.max(rx,Math.min(cx,rx+rw)),closestY=Math.max(ry,Math.min(cy,ry+rh)),dx=cx-closestX,dy=cy-closestY;return dx*dx+dy*dy<=r*r}
  function init(){
    const s=localStorage.getItem(STORAGE_KEY);highScore=s?parseInt(s,10)||0:0;
    for(let i=0;i<80;i++){bgStars.push({x:Math.random()*W,y:Math.random()*H,baseAlpha:0.3+Math.random()*0.7,phase:Math.random()*Math.PI*2,speed:0.5+Math.random()*0.5})}
    attachListeners();
    showCenter('Catch the Falling Stars','Press Start to play')
  }
  function startGame(){stars=[];score=0;timeLeft=GAME_DURATION;accumSpawn=0;lastTime=performance.now();running=!0;hideCenter();requestAnimationFrame(gameLoop)}
  function endGame(){running=!1;if(score>highScore){highScore=score;try{localStorage.setItem(STORAGE_KEY,String(highScore))}catch(e){}}showCenter('Time Up! Score: '+score,'Play Again?')}
  function spawnStar(){const size=8+Math.random()*12,x=size+Math.random()*(W-2*size),baseSpeed=BASE_FALL_SPEED*(.9+Math.random()*.4),rot=0,rotSpeed=(Math.random()-.5)*2;stars.push({x,y:-size-4,size,baseSpeed,rot,rotSpeed})}
  function difficultyMultiplier(){const steps=Math.floor((GAME_DURATION-timeLeft)/DIFFICULTY_STEP);return 1+steps*.25}
  function attachListeners(){
    window.addEventListener('keydown',e=>{if(e.code==='ArrowLeft')keys.left=!0;if(e.code==='ArrowRight')keys.right=!0;if(e.code==='Space'&&!running){e.preventDefault();startGame()}});
    window.addEventListener('keyup',e=>{if(e.code==='ArrowLeft')keys.left=!1;if(e.code==='ArrowRight')keys.right=!1});
    restartBtn.addEventListener('click',startGame)
  }
  function update(dt){
    // basket movement
    const move=(keys.left?-1:0)+(keys.right?1:0);
    if(move)basket.x=Math.max(0,Math.min(W-basket.w,basket.x+move*basket.speed*dt));
    // spawn stars
    accumSpawn+=dt*1000;const elapsed=GAME_DURATION-timeLeft,spawnInterval=Math.max(220,BASE_SPAWN_INTERVAL-elapsed*6);
    while(accumSpawn>=spawnInterval){spawnStar();accumSpawn-=spawnInterval}
    // move stars
    const mult=difficultyMultiplier();
    for(let i=stars.length-1;i>=0;i--){
      const s=stars[i];s.y+=s.baseSpeed*mult*dt;s.rot+=s.rotSpeed*mult*dt;
      if(rectCircleCollide(s.x,s.y,s.size*.65,basket.x,basket.y,basket.w,basket.h)){score++;stars.splice(i,1);continue}
      if(s.y-s.size>H)stars.splice(i,1)
    }
    // twinkle background
    for(const b of bgStars){b.phase+=b.speed*dt}
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    // background stars with twinkle
    for(const b of bgStars){
      ctx.globalAlpha=b.baseAlpha+Math.sin(b.phase)*0.2;
      ctx.fillStyle="#fff";
      ctx.fillRect(b.x,b.y,2,2)
    }
    ctx.globalAlpha=1;
    // falling stars
    for(const s of stars){
      ctx.save();
      ctx.translate(s.x,s.y);
      ctx.rotate(s.rot);
      ctx.shadowColor='rgba(255,255,100,0.6)';
      ctx.shadowBlur=10;
      ctx.fillStyle='#ffd86b';
      drawStarShape(ctx,0,0,s.size,s.size*0.45,5);
      ctx.restore();
    }
    ctx.shadowBlur=0;
    // basket
    ctx.fillStyle='#7b4f2e';
    ctx.fillRect(basket.x,basket.y,basket.w,basket.h);
    ctx.fillStyle='#5a3a24';
    ctx.fillRect(basket.x,basket.y-6,basket.w,6);
    // HUD
    drawHUD();
  }
  function drawHUD(){
    ctx.font='20px Arial';ctx.textBaseline='top';ctx.fillStyle='#fff';
    ctx.fillText('Score: '+score,12,10);
    const hs='High: '+highScore;ctx.fillText(hs,W-ctx.measureText(hs).width-12,10);
    const t='Time: '+Math.max(0,Math.ceil(timeLeft))+'s';ctx.fillText(t,(W-ctx.measureText(t).width)/2,10);
  }
  function gameLoop(ts){
    if(!lastTime)lastTime=ts;
    const dt=(ts-lastTime)/1000;lastTime=ts;
    if(running){
      timeLeft-=dt;
      if(timeLeft<=0){timeLeft=0;update(dt);draw();endGame();return}
      update(dt);draw();
      requestAnimationFrame(gameLoop);
    }
  }
  function showCenter(t,sub){centerText.innerHTML='<div style="font-size:28px;font-weight:800">'+t+'</div><div style="margin-top:8px;color:#f4f4f4;font-size:14px">'+sub+'</div>';centerMessage.style.display='block'}
  function hideCenter(){centerMessage.style.display='none'}
  init();
})();
</script>
</body>
</html>
